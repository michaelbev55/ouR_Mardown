---
title: "Project 4"
author: "ouR_Markdown"
date: "2023-09-25"
output: html_document
bibliography: Project4.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



## Introduction
The main question that this study aims to target is to depict the morphological and allometric differences between eco-morphs of the genus *Anolis*.
This will be shown by comparing the mean snout-vent lengths and the mean total hind-limb lengths of varying eco-morphs, and determining if the perch height (the height of the perch in a tree, where the anole lives) and diameter (width of said perch) have any impact on the discrete patterns in the hindlimb-SVL relationship [@hagey2017there].
<br>
<br>
<center>
![An Anolis lizard](https://upload.wikimedia.org/wikipedia/commons/thumb/1/19/Anole_-_Dactyloidae.jpg/640px-Anole_-_Dactyloidae.jpg)
</center>
<br>
<br>

## Methods
To examine these morphological and allometric differences within *Anolis*, a morphological dataset and a microhabitat dataset were utilized, containing measurements of species from Queensland, Australia, and the Caribbean. Provided data on the species was combined and log-transformed for easier analysis, and four phylogenetic generalized least squares models were produced based on Brownian and Ornstein-Uhlenbeck motion modeling. Brownian motion utilizes a model in which trait value "changes randomly, in both direction and distance, over any time interval," meaning that evolution of traits has a large random component and explaining how the same trait can evolve under drastically different circumstances [@harmon2019phylogenetic]. The opposing motion model is  Ornstein-Uhlenbeck motion, where evolution occurs under stabilizing selection to arrive at an optimal trait [@harmon2019phylogenetic].

Once these models were developed, the fits of each model were assessed via information theory, determining which model best fit the hind-limb variation data.

## Results

```{r,include=FALSE}
library(tidyverse) #always
library(ape) #for evo analysis
library(nlme) #ditto
library(MuMIn) #for AIC
library(geiger) #for eco analysis
library(knitr) #for knitting options
```

```{r, "load the data",message=FALSE}
anole <- read_csv("anole.dat.csv")
anole.eco <- read_csv("anole.eco.csv")
anole.tree <- read.tree("anole.tre")
```

```{r, "join, filter, mutate to log",message=FALSE}
anole2 <- anole%>%
left_join(anole.eco)%>%
  filter(!Ecomorph%in%c("U","CH"))%>%
  na.omit()

anole.log <- anole2%>%
  mutate_at(c("SVL", "HTotal","PH","ArbPD"),log)
```


```{r, "PGLS models",message=FALSE}
### phylogenetic GLS models

#PGLS under BM, no ecomorph
pgls.BM1 <- gls(HTotal ~SVL, correlation = corBrownian(1,phy = anole.tree,form=~Species),data = anole.log, method = "ML")

#PGLS under BM, w ecomorph
pgls.BM2 <- gls(HTotal ~SVL * Ecomorph2, correlation = corBrownian(1,phy = anole.tree,form=~Species),data = anole.log, method = "ML")

#PGLS under OU, no ecomorph
pgls.OU1 <- gls(HTotal ~SVL, correlation = corMartins(0,phy = anole.tree,form=~Species),data = anole.log, method = "ML")

#PGLS under OU, w, ecomorph
pgls.OU2 <- gls(HTotal ~SVL * Ecomorph2, correlation = corMartins(0,phy = anole.tree,form=~Species),data = anole.log, method = "ML")
```

```{r, "AIC",message=FALSE}
#AIC operations
anole.phylo.aic <- AICc(pgls.BM1,pgls.BM2,pgls.OU1,pgls.OU2)
anole.phylow.aicw <- aicw(anole.phylo.aic$AICc)
```

```{r, "AIC Kable",message=FALSE}
anole.phylo.aic %>% 
  kable(caption = "Table of AICs")
```

```{r, "add residuals",message=FALSE}
#add phylo-corrected residuals
anole.log <- anole.log%>%
  mutate(phylo.res=residuals(pgls.BM2))
```

```{r, "regression plot", fig.cap="Regression plot of log-transformed HTotal vs SVL",message=FALSE}
anole.log%>%
  ggplot(aes(SVL,HTotal,col=Ecomorph2))+geom_point()+geom_smooth(method="lm")
```

```{r,"plot residuals", fig.cap="Boxplot of phylogenetically corrected hindlimb residuals versus anole ecomorph",message=FALSE}
#plot residuals
p.eco.phylo <- anole.log%>%
ggplot(aes(x=Ecomorph2,y=phylo.res)) +geom_boxplot() +stat_summary(fun=mean, geom="point", size=3)

print(p.eco.phylo)

```

After assessing the fit of each of the four phylogenetic models, the `pgls.BM2` model produced the lowest AIC score, indicating a better fit to the data compared to the other models. This model included ecomorphology as an influencing factor in the hindlimb-SVL relationship based on evolution through Brownian motion.

## Discussion
By determining which of the four models best fits the *Anolis* data, it can be seen that the hindlimb-SVL relationship can best be described by a model that includes ecomorphology and operates under Brownian motion. This suggests that these traits of hindlimb and SVL evolved randomly, but also that they evolved randomly within each lineage (since ecomorphology was an influencing factor).

## Author Contributions
Michael Bevilacqua: Created the repository, and wrote the code for questions #1, #3-#7
<br>
Audrey Berger: Wrote the information and found correct source for #2 and #8, checked other questions with own code to compare

## References


